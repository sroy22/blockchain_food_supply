{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\MscAC\\\\Blockchain\\\\2125\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\MscAC\\\\Blockchain\\\\2125\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\MscAC\\\\Blockchain\\\\2125\\\\Code\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\MscAC\\\\Blockchain\\\\2125\\\\Code\\\\src\\\\App.js\";\nimport React, { useState, useEffect } from 'react';\nimport Web3 from 'web3';\nimport Investment from './abis/Investment.json';\nimport Navbar from './Navbar';\nimport Main from './Main';\nimport Weather from './Weather';\nimport WeatherApp from './WeatherApp';\nimport Marketplace from './abis/Marketplace.json';\n\nfunction Example() {\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      account = _useState2[0],\n      setAccount = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      investment = _useState4[0],\n      setInvestment = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      marketplace = _useState6[0],\n      setMarketplace = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      farmerCount = _useState8[0],\n      setFarmerCount = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      farmers = _useState10[0],\n      setFarmers = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      productCount = _useState12[0],\n      setProductCount = _useState12[1];\n\n  var _useState13 = useState([]),\n      _useState14 = _slicedToArray(_useState13, 2),\n      products = _useState14[0],\n      setProducts = _useState14[1];\n\n  var _useState15 = useState(0),\n      _useState16 = _slicedToArray(_useState15, 2),\n      initial = _useState16[0],\n      setInitial = _useState16[1];\n\n  var _useState17 = useState(0),\n      _useState18 = _slicedToArray(_useState17, 2),\n      investorCount = _useState18[0],\n      SetInvestorCount = _useState18[1];\n\n  function loadWeb3() {\n    return _loadWeb.apply(this, arguments);\n  }\n\n  function _loadWeb() {\n    _loadWeb = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!window.ethereum) {\n                _context2.next = 6;\n                break;\n              }\n\n              window.web3 = new Web3(window.ethereum);\n              _context2.next = 4;\n              return window.ethereum.enable();\n\n            case 4:\n              _context2.next = 7;\n              break;\n\n            case 6:\n              if (window.web3) {\n                window.web3 = new Web3(window.web3.currentProvider);\n              } else {\n                window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');\n              }\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _loadWeb.apply(this, arguments);\n  }\n\n  function loadBlockchainData() {\n    return _loadBlockchainData.apply(this, arguments);\n  }\n\n  function _loadBlockchainData() {\n    _loadBlockchainData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var web3, accounts, networkId, networkData, place, count, dealcount, p, deals, i, farmer, deal, networkDataMarketplace, _place, _count, _p, _deals, c, _farmer;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              web3 = window.web3; // Load account\n\n              _context3.next = 3;\n              return web3.eth.getAccounts();\n\n            case 3:\n              accounts = _context3.sent;\n              setInitial(accounts[0]);\n              setAccount(accounts[0]); //this.setState({ account: accounts[0] })\n\n              _context3.next = 8;\n              return web3.eth.net.getId();\n\n            case 8:\n              networkId = _context3.sent;\n              networkData = Investment.networks[networkId];\n\n              if (!networkData) {\n                _context3.next = 44;\n                break;\n              }\n\n              place = new web3.eth.Contract(Investment.abi, networkData.address);\n              setInvestment(place);\n              _context3.next = 15;\n              return place.methods.farmerCount().call();\n\n            case 15:\n              count = _context3.sent;\n              setFarmerCount(count); // Load products\n\n              _context3.next = 19;\n              return place.methods.dealCount().call();\n\n            case 19:\n              dealcount = _context3.sent;\n              SetInvestorCount(dealcount);\n              p = [];\n              deals = [];\n              i = 1;\n\n            case 24:\n              if (!(i <= count)) {\n                _context3.next = 32;\n                break;\n              }\n\n              _context3.next = 27;\n              return place.methods.farmers(i).call();\n\n            case 27:\n              farmer = _context3.sent;\n              p.push(farmer);\n\n            case 29:\n              i++;\n              _context3.next = 24;\n              break;\n\n            case 32:\n              i = 1;\n\n            case 33:\n              if (!(i <= dealcount)) {\n                _context3.next = 41;\n                break;\n              }\n\n              _context3.next = 36;\n              return place.methods.deals(i).call();\n\n            case 36:\n              deal = _context3.sent;\n              deals.push(deal);\n\n            case 38:\n              i++;\n              _context3.next = 33;\n              break;\n\n            case 41:\n              setFarmers(p);\n              _context3.next = 45;\n              break;\n\n            case 44:\n              window.alert('Marketplace contract not deployed to detected network.');\n\n            case 45:\n              networkDataMarketplace = Marketplace.networks[networkId];\n\n              if (!networkDataMarketplace) {\n                _context3.next = 68;\n                break;\n              }\n\n              _place = new web3.eth.Contract(Marketplace.abi, networkDataMarketplace.address);\n              setMarketplace(_place);\n              _context3.next = 51;\n              return _place.methods.productCount().call();\n\n            case 51:\n              _count = _context3.sent;\n              console.log(_count);\n              setProductCount(_count); // Load products\n\n              _p = [];\n              _deals = [];\n              i = 1;\n\n            case 57:\n              if (!(i <= _count)) {\n                _context3.next = 65;\n                break;\n              }\n\n              _context3.next = 60;\n              return _place.methods.products(i).call();\n\n            case 60:\n              _farmer = _context3.sent;\n\n              _p.push(_farmer);\n\n            case 62:\n              i++;\n              _context3.next = 57;\n              break;\n\n            case 65:\n              setProducts(_p);\n              _context3.next = 69;\n              break;\n\n            case 68:\n              window.alert('Marketplace contract not deployed to detected network.');\n\n            case 69:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _loadBlockchainData.apply(this, arguments);\n  }\n\n  function createInsurance(_x, _x2) {\n    return _createInsurance.apply(this, arguments);\n  }\n\n  function _createInsurance() {\n    _createInsurance = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(name, price) {\n      var delayInMilliseconds;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              console.log(initial);\n              console.log(\"Hhsjdhfskj\");\n              marketplace.methods.createProduct(name, price, initial).send({\n                from: account,\n                value: price\n              }).on('transactionHash', function (hash) {});\n              delayInMilliseconds = 8000; //1 second\n\n              setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        //your code to be executed after 1 second\n                        loadBlockchainData();\n\n                      case 1:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              })), delayInMilliseconds);\n\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n    return _createInsurance.apply(this, arguments);\n  }\n\n  function reimburse(id, price) {\n    marketplace.methods.purchaseProduct(id).send({\n      from: account,\n      value: price,\n      to: initial\n    });\n    var delayInMilliseconds = 8000; //1 second\n\n    setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              loadBlockchainData();\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })), delayInMilliseconds);\n  }\n\n  window.ethereum.on('accountsChanged', function (accounts) {\n    // Time to reload your interface with accounts[0]!\n    setAccount(accounts[0]);\n  });\n\n  function createProduct(_x3, _x4, _x5, _x6, _x7, _x8, _x9, _x10) {\n    return _createProduct.apply(this, arguments);\n  }\n\n  function _createProduct() {\n    _createProduct = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(name, location, crop, quantity, price, expiryDate, holding, costToProduce) {\n      var delayInMilliseconds;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              investment.methods.createFarmer(name, location, crop, quantity, price, expiryDate, holding, costToProduce).send({\n                from: account\n              });\n              delayInMilliseconds = 8000; //1 second\n\n              setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                  while (1) {\n                    switch (_context6.prev = _context6.next) {\n                      case 0:\n                        //your code to be executed after 1 second\n                        loadBlockchainData();\n\n                      case 1:\n                      case \"end\":\n                        return _context6.stop();\n                    }\n                  }\n                }, _callee6);\n              })), delayInMilliseconds);\n\n            case 3:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n    return _createProduct.apply(this, arguments);\n  }\n\n  function payBackToInvestor(_x11) {\n    return _payBackToInvestor.apply(this, arguments);\n  }\n\n  function _payBackToInvestor() {\n    _payBackToInvestor = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(event) {\n      var deals, i, deal;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              deals = [];\n              i = 1;\n\n            case 2:\n              if (!(i <= investorCount)) {\n                _context8.next = 12;\n                break;\n              }\n\n              _context8.next = 5;\n              return investment.methods.deals(i).call();\n\n            case 5:\n              deal = _context8.sent;\n              deal.amount = deal.amount;\n              investment.methods.repay(deal.farmerID).send({\n                from: account,\n                value: deal.amount,\n                to: deal.investorAddress\n              });\n              deals.push(deal);\n\n            case 9:\n              i++;\n              _context8.next = 2;\n              break;\n\n            case 12:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n    return _payBackToInvestor.apply(this, arguments);\n  }\n\n  function purchaseProduct(_x12, _x13, _x14) {\n    return _purchaseProduct.apply(this, arguments);\n  } // Similar to componentDidMount and componentDidUpdate:\n\n\n  function _purchaseProduct() {\n    _purchaseProduct = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(id, costToProduce, holdingPercent) {\n      var price, farmer, delayInMilliseconds;\n      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              price = holdingPercent * 0.01 * costToProduce + \"000000000000000000\";\n              _context10.next = 3;\n              return investment.methods.farmers(id).call();\n\n            case 3:\n              farmer = _context10.sent;\n              investment.methods.purchaseProduct(id).send({\n                from: account,\n                value: price,\n                to: initial\n              });\n              investment.methods.createAgreement(id, price, holdingPercent).send({\n                from: account\n              });\n              delayInMilliseconds = 8000; //1 second\n\n              setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                  while (1) {\n                    switch (_context9.prev = _context9.next) {\n                      case 0:\n                        //your code to be executed after 1 second\n                        loadBlockchainData();\n\n                      case 1:\n                      case \"end\":\n                        return _context9.stop();\n                    }\n                  }\n                }, _callee9);\n              })), delayInMilliseconds);\n\n            case 8:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10);\n    }));\n    return _purchaseProduct.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    loadWeb3();\n    loadBlockchainData(); // Update the document title using the browser API\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Navbar, {\n    account: account,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"main\", {\n    role: \"main\",\n    className: \"col-lg-12 d-flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Main, {\n    products: farmers,\n    createProduct: createProduct,\n    purchaseProduct: purchaseProduct,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-primary\",\n    onClick: payBackToInvestor,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 17\n    }\n  }, \"Pay back to investors\")))));\n}\n\nexport default Example;","map":{"version":3,"sources":["C:/MscAC/Blockchain/2125/Code/src/App.js"],"names":["React","useState","useEffect","Web3","Investment","Navbar","Main","Weather","WeatherApp","Marketplace","Example","account","setAccount","investment","setInvestment","marketplace","setMarketplace","farmerCount","setFarmerCount","farmers","setFarmers","productCount","setProductCount","products","setProducts","initial","setInitial","investorCount","SetInvestorCount","loadWeb3","window","ethereum","web3","enable","currentProvider","alert","loadBlockchainData","eth","getAccounts","accounts","net","getId","networkId","networkData","networks","place","Contract","abi","address","methods","call","count","dealCount","dealcount","p","deals","i","farmer","push","deal","networkDataMarketplace","console","log","createInsurance","name","price","createProduct","send","from","value","on","hash","delayInMilliseconds","setTimeout","reimburse","id","purchaseProduct","to","location","crop","quantity","expiryDate","holding","costToProduce","createFarmer","payBackToInvestor","event","amount","repay","farmerID","investorAddress","holdingPercent","createAgreement"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Web3 from 'web3'\nimport Investment from './abis/Investment.json'\nimport Navbar from './Navbar'\nimport Main from './Main'\nimport Weather from './Weather';\nimport WeatherApp from './WeatherApp';\nimport Marketplace from './abis/Marketplace.json'\n\n\n\nfunction Example() {\n  const [account, setAccount] = useState(0);\n  const [investment, setInvestment] = useState(null);\n  const [marketplace, setMarketplace] = useState(null);\n\n  const [farmerCount, setFarmerCount] = useState(0);\n  const [farmers, setFarmers] = useState([]);\n\n  const [productCount, setProductCount] = useState(0);\n  const [products, setProducts] = useState([]);\n\n  const [initial, setInitial] = useState(0);\n  const [investorCount, SetInvestorCount] = useState(0);\n\n  async function loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum)\n      await window.ethereum.enable()\n    }\n    else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider)\n    }\n    else {\n      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')\n    }\n  }\n  async function loadBlockchainData() {\n    const web3 = window.web3\n    // Load account\n    const accounts = await web3.eth.getAccounts()\n    setInitial(accounts[0]);\n    setAccount(accounts[0]);\n    //this.setState({ account: accounts[0] })\n    const networkId = await web3.eth.net.getId()\n    const networkData = Investment.networks[networkId]\n    if(networkData) {\n      const place = new web3.eth.Contract(Investment.abi, networkData.address)\n      setInvestment(place);\n      const count = await place.methods.farmerCount().call()\n      setFarmerCount(count);\n      // Load products\n\n      const dealcount = await place.methods.dealCount().call()\n      SetInvestorCount(dealcount);\n      let p = []\n      let deals = [];\n      for (var i = 1; i <= count; i++) {\n        const farmer = await place.methods.farmers(i).call()\n        p.push(farmer);\n      }\n      for (var i = 1; i <= dealcount; i++) {\n        const deal = await place.methods.deals(i).call()\n        deals.push(deal);\n      }\n      setFarmers(p);\n    } else {\n      window.alert('Marketplace contract not deployed to detected network.')\n    }\n\n    const networkDataMarketplace = Marketplace.networks[networkId]\n    if(networkDataMarketplace) {\n      const place = new web3.eth.Contract(Marketplace.abi, networkDataMarketplace.address)\n      setMarketplace(place);\n      const count = await place.methods.productCount().call()\n      console.log(count);\n      setProductCount(count);\n      // Load products\n\n      let p = []\n      let deals = [];\n      let c;\n      for (var i = 1; i <= count; i++) {\n        const farmer = await place.methods.products(i).call()\n        p.push(farmer);\n      }\n      setProducts(p);\n    } else {\n      window.alert('Marketplace contract not deployed to detected network.')\n    }\n  }\n\n\n  async function createInsurance(name, price) {\n    console.log(initial);\n     console.log(\"Hhsjdhfskj\");\n     marketplace.methods.createProduct(name, price, initial).send({ from: account, value: price })\n     .on('transactionHash', (hash) => {\n     })\n \n     var delayInMilliseconds = 8000; //1 second\n \n setTimeout( async function() {\n   //your code to be executed after 1 second\n   loadBlockchainData();\n \n }, delayInMilliseconds);\n \n   }\n \n   function   reimburse(id, price) {\n      marketplace.methods.purchaseProduct(id).send({ from: account, value: price, to: initial }) \n     var delayInMilliseconds = 8000; //1 second\n  setTimeout( async function() {\n          loadBlockchainData();\n      }, delayInMilliseconds);\n   }\n\n\n   window.ethereum.on('accountsChanged', function (accounts) {\n     // Time to reload your interface with accounts[0]!\n     setAccount(accounts[0])\n   })\n  \n async function createProduct(name, location, crop, quantity, price, expiryDate, holding, costToProduce) {\n    investment.methods.createFarmer(name, location, crop, quantity, price, expiryDate, holding, costToProduce).send({ from: account })\n    var delayInMilliseconds = 8000; //1 second\n    setTimeout( async function() {\n      //your code to be executed after 1 second\n      loadBlockchainData();\n      }, delayInMilliseconds);\n    }\n\n  async function payBackToInvestor(event){\n    let deals = [];\n    for (var i = 1; i <= investorCount; i++) {\n      const deal = await investment.methods.deals(i).call()\n      deal.amount = deal.amount;\n      investment.methods.repay(deal.farmerID).send({ from: account, value: deal.amount, to: deal.investorAddress})\n      deals.push(deal);\n    }\n  }\n\n async function   purchaseProduct(id, costToProduce, holdingPercent) {\n    const price = holdingPercent*0.01*costToProduce +  \"000000000000000000\";\n    const farmer = await investment.methods.farmers(id).call();\n    investment.methods.purchaseProduct(id).send({ from: account, value: price, to: initial })\n    investment.methods.createAgreement(id,price, holdingPercent).send({ from: account })\n    var delayInMilliseconds = 8000; //1 second\n  setTimeout( async function() {\n        //your code to be executed after 1 second\n    loadBlockchainData();\n    }, delayInMilliseconds);\n    }\n\n  // Similar to componentDidMount and componentDidUpdate:\n  useEffect(() => {\n    loadWeb3();\n    loadBlockchainData();\n    // Update the document title using the browser API\n  }, []);\n  \n\n  return (\n    <div>\n    <Navbar account={account} />\n    <div className=\"container-fluid mt-5\">\n      <div className=\"row\">\n        <main role=\"main\" className=\"col-lg-12 d-flex\">\n          \n            <div> \n            <Main\n              products={farmers}\n              createProduct={createProduct}\n              purchaseProduct={purchaseProduct} />\n                </div>\n                <button type=\"submit\" className=\"btn btn-primary\" onClick= {payBackToInvestor}>Pay back to investors</button>\n        \n        {/* <Weather\n          customers = {products}\n          createInsurance = {createInsurance}\n          reimburse = {reimburse}\n        /> */}\n        </main>\n      </div>\n    </div>\n  </div>\n  );\n}\nexport default Example;\n"]},"metadata":{},"sourceType":"module"}